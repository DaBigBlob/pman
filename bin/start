#!/bin/sh

CMMD="sh test_src"
PNAME="test"

mkdir -p "$HOME/.pman/$PNAME"
LOGDIR="$HOME/.pman/$PNAME"

PMAN="
printf '\\n;;; [STARTING ${CMMD}]\\n\\n' >> ${LOGDIR}/now.log
until  ${CMMD} >>${LOGDIR}/now.log 2>&1
do
    printf '\\n;;; [${CMMD} CRASHED. RESTARTING.]\\n\\n' >> ${LOGDIR}/now.log
    sleep 1
done
"

pkill -9 -f "${CMMD}"
printf "\\033[34;1m[\\033[31;1m!\\033[34;1m]\\033[0m Killed all \\033[35;1m%s\\033[0m processes\\n" "${PNAME}"

if [ -f "${LOGDIR}/now.log" ]
then
    printf "\\n;;; [NEXT LOG START]\\n\\n" >> "${LOGDIR}/old.log"
    cat "${LOGDIR}/now.log" >> "${LOGDIR}/old.log"
fi
printf "" > "${LOGDIR}/now.log"

sh -c "$PMAN" >/dev/null 2>&1 &
printf "\\033[34;1m[\\033[31;1m!\\033[34;1m]\\033[0m Triggered \\033[35;1m%s\\033[0m's process manager\\n" "${PNAME}"
printf "\\033[34;1m[\\033[32;1m*\\033[34;1m]\\033[0m Done.\\n"

